<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Artists | Ninart Vision</title>
  <meta name="description" content="Discover talented contemporary Georgian artists. Browse artist profiles, explore their unique styles, and view their available artworks.">

  <link rel="stylesheet" href="../style.css" />
  <link rel="icon" href="../images/favicon.png">

<!-- Google Analytics 4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'GA_MEASUREMENT_ID', {
    'anonymize_ip': true,
    'allow_google_signals': false,
    'allow_ad_personalization_signals': false
  });
</script>
<script src="../analytics.js"></script>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="container header-row">

    <!-- Logo -->
    <a class="brand" href="../index.html">
      <img src="../images/logo.png" alt="Ninart Vision Logo">
    </a>

    <!-- Desktop menu -->
    <nav class="nav desktop-nav">
      <a href="../index.html">Home</a>
      <a href="../support.html">Support a Project</a>
      <a href="../sale/shop.html">Shop</a>
      <a href="./" class="active">Artists</a>
      <a href="../news.html">News</a>
      <a href="../about.html">About</a>
    </nav>

    <!-- Mobile hamburger -->
    <button class="hamburger" id="openMenu" aria-label="Open menu">
      <span></span><span></span><span></span>
    </button>

  </div>
</header>

<!-- Mobile menu overlay -->
<div class="menu-overlay" id="menuOverlay">
  <button class="menu-close" id="closeMenu" aria-label="Close menu">âœ•</button>

  <nav class="menu-links">
    <a href="../index.html" class="menu-link">HOME</a>
    <a href="../support.html" class="menu-link">SUPPORT A PROJECT</a>
    <a href="../sale/shop.html" class="menu-link">SHOP</a>
    <a href="./" class="menu-link">ARTISTS</a>
    <a href="../news.html" class="menu-link">NEWS</a>
    <a href="../about.html" class="menu-link">ABOUT</a>
  </nav>
</div>

<div class="artists-header">
  <h2>Artists</h2>
  <div class="artists-art"></div>
</div>

<!-- Search input -->
<div class="container" style="margin-top: 30px; margin-bottom: 30px; max-width: 600px;">
  <input 
    type="text" 
    class="search-input" 
    id="artistSearch" 
    placeholder="Search artists by name or style..."
    aria-label="Search artists"
  />
</div>

<div class="artists-grid" id="artistsGrid"></div>

<!-- SCRIPTS -->
<script src="../script.js"></script>
<script src="../sanity-client.js"></script>

<script>
  const grid = document.getElementById("artistsGrid");
  const searchInput = document.getElementById("artistSearch");

  let allArtists = []; // Store all artists for filtering
  let filteredArtists = []; // Currently filtered artists

  // Show loading state
  grid.innerHTML = "<p style='text-align:center'>Loading artists...</p>";

  // Fetch all artists from Sanity
  (async function() {
    try {
      allArtists = await fetchArtistsFromSanity(); // Fetch all artists without limit

      if (!allArtists || allArtists.length === 0) {
        grid.innerHTML = "<p style='text-align:center'>No artists available.</p>";
        if (searchInput) searchInput.disabled = true;
        return;
      }

      // Initially show all artists
      filteredArtists = allArtists;
      renderArtists(filteredArtists);

      // Setup search functionality
      if (searchInput) {
        searchInput.addEventListener('input', handleSearch);
        
        // Clear search on Escape key
        searchInput.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            searchInput.value = '';
            searchInput.classList.remove('searching');
            filteredArtists = allArtists;
            renderArtists(filteredArtists);
            searchInput.blur();
          }
        });
      }

    } catch (error) {
      console.error('Error loading artists:', error);
      grid.innerHTML = "<p style='text-align:center'>Unable to load artists. Please try again later.</p>";
      if (searchInput) searchInput.disabled = true;
    }
  })();

  // Search handler with debouncing
  let searchTimeout;
  function handleSearch(e) {
    const searchTerm = e.target.value.toLowerCase().trim();
    
    // Visual feedback
    if (searchTerm) {
      searchInput.classList.add('searching');
    } else {
      searchInput.classList.remove('searching');
    }
    
    // Debounce search for performance
    clearTimeout(searchTimeout);
    
    searchTimeout = setTimeout(() => {
      if (!searchTerm) {
        // Show all artists when search is empty
        filteredArtists = allArtists;
        renderArtists(filteredArtists);
        return;
      }

      // Filter artists by name and style (case-insensitive)
      filteredArtists = allArtists.filter(artist => {
        const name = (artist.name || "").toLowerCase();
        const style = (artist.style || "").toLowerCase();
        
        // Split search term to support multiple words
        const searchWords = searchTerm.split(/\s+/);
        
        // Check if all search words match in name or style
        return searchWords.every(word => 
          name.includes(word) || style.includes(word)
        );
      });

      renderArtists(filteredArtists);
      
      // Track search with debounce
      if (searchTerm && typeof trackSearch === 'function') {
        trackSearch(searchTerm, 'artists_page');
      }
    }, 200); // 200ms debounce delay
  }

  // Render artists to the grid
  function renderArtists(artists) {
    if (!artists || artists.length === 0) {
      grid.innerHTML = "<p style='text-align:center'>No artists found matching your search.</p>";
      return;
    }

    grid.innerHTML = artists.map(artist => {
      // Use slug for dynamic artist page
      const artistSlug = artist.slug?.current || artist.slug || artist._id;
      const artistPage = `artist.html?artist=${encodeURIComponent(artistSlug)}`;

      return `
        <a class="artist-card" href="${artistPage}">
          <div class="artist-avatar"
               style="background-image:url('${artist.avatar || '../images/artists/placeholder.jpg'}')">
          </div>

          <h3 class="artist-name">
            <img src="../images/icon.jpg" alt="Georgia" class="flag-icon">
            <span>${artist.name}</span>
          </h3>

          <p class="artist-style">${artist.style || ''}</p>
        </a>
      `;
    }).join("");
  }
</script>


</body>
</html>
